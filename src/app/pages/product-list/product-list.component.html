<!-- Search Bar  -->
<div class="flex flex-col mb-10 w-full">
  <div class="header-background h-24 2xl:h-28 top-0 left-0 right-0 w-full bg-sky-50">
  </div>
  <header class="max-w-2xl mx-auto -mt-10 flex flex-col lg:-mt-7 w-full px-4 sm:px-0">
    <div class="relative w-full">
      <label for="search-input" class="text-neutral-500">
        <span class="sr-only">Search all products</span>
        <input #searchInput id="search-input" type="text"
          class="w-full shadow-lg border border-neutral-200 text-sm rounded-full pl-12 sm:pl-14 pr-14 py-4 sm:py-5 bg-white focus:outline-none focus:ring-2 focus:ring-sky-200"
          [(ngModel)]="selectedFilterOptions().searchTerm" (keyup.enter)="search()" placeholder="Type your keywords" />
        <button type="button"
          class="absolute right-2.5 top-1/2 -translate-y-1/2 w-11 h-11 rounded-full bg-black hover:bg-black text-white flex items-center justify-center hover:cursor-pointer"
          (click)="search()">
          <app-icon iconName="arrow-right"></app-icon>
        </button>
        <span class="absolute left-4 sm:left-5 top-1/2 -translate-y-1/2 text-2xl md:left-6 pointer-events-none">
          <app-icon iconName="search" class="h-5 w-5"></app-icon>
        </span>
      </label>
    </div>
  </header>
</div>

<!-- Page Content -->
<div class="contained-page">

  <!-- Filter Titles  -->
  <div class="flex flex-col gap-3 sm:flex-row sm:items-center sm:justify-between mt-4 pb-4 border-b border-neutral-200">
    <!-- Hide/Show Filters on left -->
    <button type="button"
      class="self-start inline-flex items-center gap-2 rounded-full border border-neutral-200 bg-[#384f8cd9] px-4 py-2 text-sm font-medium text-white hover:bg-[#384f8cc9] cursor-pointer"
      (click)="hideFilters.set(!hideFilters())">
      <app-icon iconName="filter" class="w-4 h-4"></app-icon>
      <span>
        {{hideFilters() ? 'Show' : 'Hide'}} filters
      </span>
    </button>

    <!-- Results for chips on right -->
    @if (activeFilters().length) {
    <div class="flex flex-wrap items-center gap-2">
      <span class="text-sm text-neutral-500">Results for</span>
      @for (chip of activeFilters(); track chip.type) {
      <span
        class="group/pin inline-flex items-center gap-2 px-4 py-1.5 text-sm rounded-full cursor-pointer transition-colors"
        [class]="chip.colorClass" (click)="selectOption(chip.type, chip.name)">
        {{ chip.name }}
        <app-icon iconName="close"
          class="w-3.5 h-3.5 opacity-0 group-hover/pin:opacity-100 transition-opacity duration-200"></app-icon>
      </span>
      }
    </div>
    }
  </div>

  <!-- Filters & Product Catalog -->
  <div class="flex flex-col lg:flex-row lg:gap-10">
    <!-- Filters -->
    <div id="filters" class="mt-4 w-full lg:w-[280px] lg:shrink-0 p-4" [class.hidden]="hideFilters()">
      @for (group of filterOptions(); track group.name) {
      <div class="mb-1 pl-2">
        <h3 class=" mb-0 px-2 py-1 text-[1rem] font-light uppercase text-[#384f8c] cursor-pointer -translate-x-[10px]
          transform rounded transition-colors" [class.bg-indigo-50]="isOptionSelected(group.name)"
          [class.text-[#384f8c]]="isOptionSelected(group.name)" (click)="selectOption(group.groupType, group.name)">
          {{ group.name }}</h3>
        <div class="flex flex-col gap-1 mb-1">
          @for (option of group.options; track option.name) {
          <p class="category-leaf text-sm cursor-pointer mb-0 hover:text-[#384f8c] px-2 py-1 rounded transition-colors group/filter flex items-center justify-between"
            [class.bg-indigo-50]="isOptionSelected(option.name)" [class.text-[#384f8c]]="isOptionSelected(option.name)"
            (click)="selectOption(group.groupType, option.name)">
            <span>{{ option.name }}</span>
            @if (isOptionSelected(option.name)) {
            <app-icon iconName="close"
              class="w-4 h-4 opacity-0 group-hover/filter:opacity-100 transition-opacity duration-200"></app-icon>
            }
          </p>
          }
        </div>
      </div>
      <hr class="mb-4 border-b-1 border-indigo-800 w-[140px] ml-0 opacity-15">
      }
    </div>

    <!-- Product Catalog -->
    <div class="mt-6 lg:mt-4 w-full mb-15">
      @if (products().data?.length) {
      <div class="grid grid-cols-2 sm:grid-cols-2 md:grid-cols-3 xl:grid-cols-4 gap-0 md:gap-6 mb-2">
        @for (product of products().data; track product.id) {
        <app-product-card [product]="product" class=""></app-product-card>
        }
      </div>
      } @else {
      <div class="flex flex-col items-center justify-center py-20">
        <app-icon iconName="search" class="w-16 h-16 text-neutral-300 mb-4"></app-icon>
        <p class="text-neutral-500 text-lg mb-1">No products found</p>
        <p class="text-neutral-400 text-sm">Try adjusting your filters or search term</p>
      </div>
      }
      <div class="flex justify-center mt-12">
        <app-pagination (paginationChanged)="onPaginationChanged()" [className]="'mt-8'"
          [totalPages]="products().totalPage" [(pageIndex)]="selectedFilterOptions().pageIndex"
          [(pageSize)]="selectedFilterOptions().pageSize"></app-pagination>
      </div>
    </div>

  </div>
</div>