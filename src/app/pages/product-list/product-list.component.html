<!-- Search Bar  -->
<div class="flex flex-col mt-20 mb-10 w-full">
  <div class="header-background h-24 2xl:h-28 top-0 left-0 right-0 w-full bg-sky-50 ">
  </div>
  <header class="max-w-2xl mx-auto -mt-10 flex flex-col lg:-mt-7 w-full">
    <div class="relative w-full">
      <label for="search-input" class="text-neutral-500">
        <span class="sr-only">Search all products</span>
        <input #searchInput id="search-input" type="text"
          class="w-full shadow-lg border border-neutral-200 text-sm rounded-full pl-14 pr-14 py-5 bg-white focus:outline-none focus:ring-2 focus:ring-sky-200"
          [(ngModel)]="selectedFilterOptions().searchTerm" (keyup.enter)="search()" placeholder="Type your keywords" />
        <button type="button"
          class="absolute right-2.5 top-1/2 -translate-y-1/2 w-11 h-11 rounded-full bg-black hover:bg-black text-white flex items-center justify-center hover:cursor-pointer"
          (click)="search()">
          <app-icon iconName="arrow-right"></app-icon>
        </button>
        <span class="absolute left-5 top-1/2 -translate-y-1/2 text-2xl md:left-6 pointer-events-none">
          <svg class="h-5 w-5" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path
              d="M11.5 21C16.7467 21 21 16.7467 21 11.5C21 6.25329 16.7467 2 11.5 2C6.25329 2 2 6.25329 2 11.5C2 16.7467 6.25329 21 11.5 21Z"
              stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" />
            <path d="M22 22L20 20" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"
              stroke-linejoin="round" />
          </svg>
        </span>
      </label>
    </div>
  </header>
</div>

<!-- Page Content -->
<div class="contained-page">

  <!-- Filter Titles  -->
  <div class="flex items-center justify-between mt-4 pb-4 border-b border-neutral-200">
    <!-- Hide/Show Filters on left -->
    <h2 class="mb-0 pl-2 bg-white rounded-[5px] filter-title hover:cursor-pointer" [class.clicked]="!hideFilters()"
      (click)="hideFilters.set(!hideFilters())">
      <span class="inline-flex border-indigo-900 pr-4 text-[17px]">
        {{hideFilters() ? 'View All ' : 'Hide '}}Filters
      </span>
    </h2>

    <!-- Results for chips on right -->
    @if (activeFilters().length) {
    <div class="flex flex-wrap items-center gap-2">
      <span class="text-sm text-neutral-500">Results for</span>
      @for (chip of activeFilters(); track chip.type) {
      <span
        class="group/pin inline-flex items-center gap-2 px-4 py-1.5 text-sm rounded-full cursor-pointer transition-colors"
        [class]="chip.colorClass" (click)="selectOption(chip.type, chip.name)">
        {{ chip.name }}
        <svg class="w-3.5 h-3.5 opacity-0 group-hover/pin:opacity-100 transition-opacity duration-200" fill="none"
          stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
        </svg>
      </span>
      }
    </div>
    }
  </div>

  <!-- Filters & Product Catalog -->
  <div class="flex">
    <!-- Filters -->
    <div id="filters" class="flex-2 mt-4" [class.hidden]="hideFilters()">
      @for (group of filterOptions(); track group.name) {
      <div class="mb-1 pl-2">
        <h3 class="mb-1 text-[16px] font-light uppercase text-slate-900">{{ group.name }}</h3>
        <div class="flex flex-col gap-1 mb-1">
          @for (option of group.options; track option.name) {
          <p class="category-leaf text-sm cursor-pointer mb-0 hover:text-indigo-700 px-2 py-1 rounded transition-colors group/filter flex items-center justify-between"
            [class.bg-indigo-50]="isOptionSelected(option.name)" [class.text-indigo-700]="isOptionSelected(option.name)"
            (click)="selectOption(group.groupType, option.name)">
            <span>{{ option.name }}</span>
            @if (isOptionSelected(option.name)) {
            <svg class="w-4 h-4 opacity-0 group-hover/filter:opacity-100 transition-opacity duration-200" fill="none"
              stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
            </svg>
            }
          </p>
          }
        </div>
      </div>
      <hr class="mb-4 border-b-1 border-indigo-800 w-[150px] ml-0 opacity-15">
      }
    </div>

    <!-- Product Catalog -->
    <div class="flex-10 mb-15">
      @if (products().data?.length) {
      <div class="grid grid-cols-4 mb-2">
        @for (product of products().data; track product.id) {
        <app-product-card [product]="product" class=""></app-product-card>
        }
      </div>
      } @else {
      <div class="flex flex-col items-center justify-center py-20">
        <svg class="w-16 h-16 text-neutral-300 mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5"
            d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />
        </svg>
        <p class="text-neutral-500 text-lg mb-1">No products found</p>
        <p class="text-neutral-400 text-sm">Try adjusting your filters or search term</p>
      </div>
      }
      <div class="flex justify-center mt-12">
        <app-pagination (paginationChanged)="onPaginationChanged()" [className]="'mt-8'"
          [totalPages]="products().totalPage" [(pageIndex)]="selectedFilterOptions().pageIndex"
          [(pageSize)]="selectedFilterOptions().pageSize"></app-pagination>
      </div>
    </div>

  </div>
</div>
